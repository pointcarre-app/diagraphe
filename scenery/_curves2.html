<!DOCTYPE html>
<html lang="en" data-theme="anchor">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Scenery : Curves</title>

    <!-- CSS Dependencies -->
    <link rel="stylesheet" href="../dependencies/google_fonts.css" />
    <link rel="stylesheet" href="../dependencies/open_dyslexic_regular.css" />
    <link rel="stylesheet" href="../dependencies/daisyui@5.css" />
    <link rel="stylesheet" href="../dependencies/daisyui@5themes.css" />
    <link rel="stylesheet" href="../dependencies/katex.css" />
    <script src="../dependencies/katex.js"></script>
    <script src="../dependencies/katex-autorender.js"></script>


    <!-- Our CSS -->
    <!-- Just variables (fonts & themes) -->
    <link rel="stylesheet" href="../src/css/root.css" />

    <!-- SVG theming : ie fill / stroke for semantic colors (content variants) -->
    <link rel="stylesheet" href="../src/css/daisyui-svg-theming.css" />
    <link rel="stylesheet" href="../src/css/global.css" />

    <!-- JavaScript Dependencies -->
    <script src="../dependencies/tailwindcssbrowser@4.js"></script>


    <style>
        foreignObject [data-diagraphe-latex="true"] {
            overflow: visible;
        }
    </style>


    <!-- Diagraphe Module -->
    <script type="module">
        import {
            Diagraphe
        } from '../src/diagraphe.js';


        let baseConfig = {
            width: 300,
            height: 300,
            margin: {
                top: 0,
                right: 0,
                bottom: 0,
                left: 0
            },
            svg: {
                classes: ['bg-base-300'],
            }
        }

        let cartesian_space = {
            xMin: -2,
            xMax: 2,
            yMin: -2,
            yMax: 2,
        }

        let demoConfig = {
            label: 'Axes',
            description: 'Cartesian coordinate system with axes and points',
            config: {
                ...baseConfig,
                elements: [{
                        nature: 'axes',
                        classes: ['fill-secondary'],
                        grid: true,
                        showTickLabels: true,
                        xTicks: [0, 1, 5],
                        yTicks: [1],
                        showAxisLabels: true,
                    }, {
                        nature: 'cartesian_dot',
                        classes: ['fill-secondary'],
                        label: "A",
                        showLabel: true,
                        x: 5,
                        y: 3,
                    }, {
                        nature: 'cartesian_dot',
                        classes: ['fill-primary'],
                        label: "B",
                        showLabel: true,
                        x: 2,
                        y: 1,
                    }, {
                        nature: 'foreign_object',
                        x: 100, // Center of the drawable area (innerWidth / 2 â‰ˆ 230/2)
                        y: 200,
                        foWidth: 150,
                        foHeight: 40,
                        //centered: true, // x, y now represent the CENTER of the foreignObject
                        html: '<span style="font-size: 14px; color: var(--color-base-content);">Not centered ðŸŽ‰</span>',
                        contentClasses: ['p-2', 'bg-base-200', 'rounded'],
                    },

                    {
                        nature: 'foreign_object',
                        x: 115,
                        y: 30,
                        foWidth: 250,
                        foHeight: 40,
                        centered: true, // Uses 1x1 anchor + overflow visible + transform centering
                        html: '<div class="badge badge-primary">daisyUI in SVG!</div>',
                        contentClasses: ['p-2', 'bg-base-200', 'rounded'],
                    }, {
                        nature: 'foreign_object',
                        x: 50,
                        y: 100,
                        centered: true, // No foWidth/foHeight needed!
                        html: '<div class="badge badge-primary">daisyUI</div>',
                    }, {
                        // LaTeX with centered: true â€” no need to specify dimensions
                        nature: 'foreign_object',
                        x: 75, // center of drawable area
                        y: 225,
                        centered: true,
                        html: '<div data-diagraphe-latex="true">$f(x) = x^2$</div>',
                    }


                    //, {
                    //// Another LaTeX example - longer expression, still works!
                    //nature: 'foreign_object',
                    //x: 115,
                    //y: 180,
                    //centered: true,
                    //html: '<span data-diagraphe-latex="true">$\\int_0^\\infty e^{-x^2} dx = \\frac{\\sqrt{\\pi}}{2}$</span>',
                    //}

                ]
            }
        }


        document.addEventListener('DOMContentLoaded', () => {
            const container = document.querySelector('#graph-container');

            // Escape HTML entities so <div> etc. are displayed as text, not rendered
            const escapeHtml = (str) => str
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;').replace(/>/g, '&gt;');

            // Build config display string
            const configStr = escapeHtml(
                JSON.stringify(demoConfig.config, null, 2)
                .replace(/"([^"]+)":/g, '$1:') // Remove quotes from keys
            );

            container.innerHTML = `
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h3 class="card-title text-lg">${demoConfig.label}</h3>
                        <p class="text-sm text-base-content/70 mb-4">${demoConfig.description}</p>
                        <div class="graph-demo mb-4"></div>
                        <details class="collapse collapse-arrow bg-base-200">
                            <summary class="collapse-title text-sm font-medium py-2 min-h-0">Configuration</summary>
                            <div class="collapse-content">
                                <pre class="text-xs overflow-x-auto"><code>${configStr}</code></pre>
                            </div>
                        </details>
                    </div>
                </div>
            `;

            // Render the graph
            new Diagraphe({
                container: container.querySelector('.graph-demo'),
                ...demoConfig.config
            });
        });
    </script>
  </head>
  <body>
    <main id="main" class="container mx-auto p-4 max-w-4xl mt-12">

      <div class="text-2xl font-bold">LaTeX in SVG</div>
      <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
          <div class="font-mono p-3 bg-base-300">class="text-lg" + $$ ... $$</div>
          <div data-diagraphe-latex="true" class="text-lg">$$f(x) = x^2$$</div>
          <div class="font-mono p-3 bg-base-300">class="" + $$ ... $$</div>
          <div data-diagraphe-latex="true" class="">$$f(x) = x^2$$</div>
          <div class="font-mono p-3 bg-base-300">class="text-lg" + $ ... $</div>
          <div data-diagraphe-latex="true" class="text-lg">$f(x) = x^2$</div>
          <div class="font-mono p-3 bg-base-300">class="" + $ ... $</div>
          <div data-diagraphe-latex="true" class="">$f(x) = x^2$</div>
        </div>
      </div>
      <div id="graph-container"></div>
    </main>
  </body>

  <script>
      document.addEventListener('DOMContentLoaded', () => {
          // Only render math in elements with data-diagraphe-latex="true"
          const mathElements = document.querySelectorAll('[data-diagraphe-latex="true"]');

          mathElements.forEach(element => {
              renderMathInElement(element, {
                  // Only render $$ (display) and $ (inline) delimiters
                  delimiters: [{
                          left: "$$",
                          right: "$$",
                          display: true
                      }, // Display math: $$
                      {
                          left: "$",
                          right: "$",
                          display: false
                      } // Inline math: $
                  ],

                  // Safe and common options
                  throwOnError: false, // Don't throw errors, show them instead
                  errorColor: "#cc0000", // Red color for math errors
                  trust: false, // Don't trust user input (safer)
                  strict: "ignore", // Ignore strict mode violations
                  maxSize: Infinity, // Allow unlimited size
                  maxExpand: 1000, // Max expansion depth
                  colorIsTextColor: false, // Don't treat colors as text colors

                  // Custom error handling
                  errorCallback: function(msg, err) {
                      console.warn("KaTeX error:", msg, err);
                  }
              });
          });
      });
  </script>
</html>
